<!DOCTYPE html>
<html>
  <meta charset="UTF-8">
  <!-- Copyright (C) 2017 trainbird999

       This program is free software: you can redistribute it and/or modify
       it under the terms of the GNU General Public License as published by
       the Free Software Foundation, either version 3 of the License, or
       (at your option) any later version.

       This program is distributed in the hope that it will be useful,
       but WITHOUT ANY WARRANTY; without even the implied warranty of
       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
       GNU General Public License for more details.

       You should have received a copy of the GNU General Public License
       along with this program.  If not, see <http://www.gnu.org/licenses/>.
     -->
  <head>
    <title>JS Tpcalc - Transport Fever Caluculation Support Utility</title>
    <style type="text/css">
     <!--
     H2 {color: #ffb608;}
     button {background: #b0b7c1; color: #2e3a50; border-style: none; border-radius: 7.5px;}
     button:hover {background: #ffc618;}
     input {background: #3e4a60; color: #d89ed2; font-size: 101%; text-align: center; border-style: none;}
     body.darktheme {color: #eeeeee;background: #2e3a50;}
     form.rightalign {text-align: right};
     -->
    </style>
  </head>
  <body class="darktheme">
    <script type="text/javascript">
     <!--
     function sec_per_oneday() {
       return parseFloat(document.ms_per_day.ms_value.value) / 1000.0;
     }

     function sec_per_year() {
       return sec_per_oneday() * 365;
     }

     function selectElementsById(collection, id) {
       function selecter(collection, id, new_array, n) {
         if (collection.length == n) {
           return new_array;
         } else {
           var element = collection[n];
           if (element.id == id) {
             new_array.push(element);
           }
           return selecter(collection, id, new_array, n + 1);
         }
       }
       return selecter(collection, id, [], 0);
     }

     function changeText(array, str) {
       function changer(array, str, n) {
         if (array.length == n) {
           return;
         } else {
           array[n].textContent = str;
           return changer(array, str, n + 1);
         }
       }
       changer(array, str, 0);
     }

     function updateSpyText(spy) {
       var array = selectElementsById(document.getElementsByTagName("span"), "span_spy");
       changeText(array, spy);
     }


     function oscillationBool() {
       var current = true;
       return function() {
         current = !current;
         return current;
       }
     }

     function newSpan(id) {
       var newSpan           = document.createElement("span");
       newSpan.id     = id;
       return newSpan;
     }

     function newLabel(forId, text) {
       var newLabel          = document.createElement("label");
       newLabel.for          = forId;
       newLabel.textContent  = text;
       return newLabel;
     }
     function newSelect(id, name, fonchange) {
       var newSelect         = document.createElement("select");
       newSelect.id          = id;
       newSelect.name        = name;
       newSelect.onchange    = fonchange;
       return newSelect;
     }

     function newOption(value, text) {
       var newOption         = document.createElement("option");
       newOption.value       = value;
       newOption.textContent = text;
       return newOption;
     }

     function newInputForm(type, name, placeholder, foninput) {
       var newInputForm         = document.createElement("input");
       newInputForm.type        = type;
       newInputForm.name        = name;
       newInputForm.placeholder = placeholder;
       newInputForm.oninput     = foninput;
       newInputForm.onkeydown     = function() {return null};
       return newInputForm;
     }

     function newDummyInputForm() {
       var newInputForm         = document.createElement("input");
       newInputForm.type        = "input";
       newInputForm.name        = "dummyinput";
       newInputForm.style       = "display:none;";
       return newInputForm;
     }

     function newLink(text, fonclick) {
       var newLink         = document.createElement("a");
       newLink.textContent = text;
       newLink.href        = "javascript void(0)";
       newLink.onclick     = fonclick;
       return newLink;
     }
     function modeSelectElement() {
       var element = newLink(" ##__toogle_mode__## ",
                          function() {
                            toggleMsInputMenu(document.getElementById("target_span_menu_switch"));
                            return false;
                          });
       return element;
     }


     function addChildRecursively(parentElement, elementGenerator) {
       var newElement = elementGenerator();
       if (newElement == null) {
         return;
       } else {
         parentElement.appendChild(newElement);
         return addChildRecursively(parentElement, elementGenerator);
       }
     }


     function constructSelectMenu() {
       var newElementRoot = newSpan("target_span_menu_switch");

       var label          = newLabel("ms_value", "##__select_your_game_s_spy__## : ");
       newElementRoot.appendChild(label);

       var select         = newSelect("ms_value",
                                      "ms_value",
                                      function(event) {
                                        return updateSpyText(sec_per_year());
                                      });
       newElementRoot.appendChild(select);
         
       function optionGen() {
         var dArray = [["2000", "2##__sec_notation_and_default__##"],
                       ["1000", "1##__sec_notation__##"],
                       ["3000", "3##__sec_notation__##"],
                       ["4000", "4##__sec_notation__##"],
                       ["5000", "5##__sec_notation__##"],
                       ["6000", "6##__sec_notation__##"],
                       ["7000", "7##__sec_notation__##"],
                       ["8000", "8##__sec_notation_and_max__##"]];
         var index  = 0;
         var fGen   = function() {
           if (index == dArray.length) {
             return null;
           } else {
             var option = newOption(dArray[index][0], dArray[index][1]);
             index = index + 1;
             return option;
           }
         }
         return fGen;
       }
       addChildRecursively(select, optionGen());

       newElementRoot.appendChild(modeSelectElement());
       
       return newElementRoot;
     }

     function constructInputMenu() {
       var newElementRoot = newSpan("target_span_menu_switch");

       var label          = newLabel("ms_value", "##__input_your_game_s_spy__## : ");
       newElementRoot.appendChild(label);

       var inputForm      = newInputForm("text",
                                         "ms_value",
                                         "##__input_here__##",
                                         function(event) {
                                           return updateSpyText(sec_per_year());
                                         });
       
       newElementRoot.appendChild(inputForm);
       newElementRoot.appendChild(newDummyInputForm()); // avoid text subbmission
       newElementRoot.appendChild(modeSelectElement());
       
       return newElementRoot;
     }

     var tOrF = oscillationBool();
     function toggleMsInputMenu(targetElement) {
       if (tOrF()) {
         targetElement.parentNode.replaceChild(constructSelectMenu(), targetElement);
       } else {
         targetElement.parentNode.replaceChild(constructInputMenu(), targetElement);
       }
     }


     function calcfrequency(capacities, demands) {
       return sec_per_year() * capacities / demands;
     }

     function showfreq() {
       var demands    = parseFloat(document.calcfreq.demands.value);
       var capacities = parseFloat(document.calcfreq.capacities.value);
       document.calcfreq.result.value = calcfrequency(capacities, demands);
     }

     function calccapacity(demands, frequencies) {
       return demands * frequencies / sec_per_year();
     }

     function showcap() {
       var demands     = parseFloat(document.calccap.demands.value);
       var frequencies = parseFloat(document.calccap.frequencies.value);
       document.calccap.result.value  = calccapacity(demands, frequencies);
     }

     function calcrate(capacities, frequencies) {
       return sec_per_year() * capacities / frequencies;
     }

     function showrate() {
       var capacities  = parseFloat(document.calcrate.capacities.value);
       var frequencies = parseFloat(document.calcrate.frequencies.value);
       document.calcrate.result.value = calcrate(capacities, frequencies);
     }
     // -->
    </script>

    <form name="ms_per_day" class="rightalign">
      <span id="target_span_menu_switch">
        <label   for="ms_value">##__select_your_game_s_spy__##</label>
        <select name="ms_value" id="ms_value" onChange="updateSpyText(sec_per_year())">
          <option value="2000">2##__sec_notation_and_default__##</option>
          <option value="1000">1##__sec_notation__##</option>
          <option value="3000">3##__sec_notation__##</option>
          <option value="4000">4##__sec_notation__##</option>
          <option value="5000">5##__sec_notation__##</option>
          <option value="6000">6##__sec_notation__##</option>
          <option value="7000">7##__sec_notation__##</option>
          <option value="8000">8##__sec_notation__##</option>
        </select>
      </span>
    </form>


    <H2>##__title_frequency_calculation__##</H2>
    <p>##__text_frequency_calculation__##</p>
    <form name="calcfreq" action="#">
      <span id="span_spy">730</span> ร
      <input type="text" name="capacities" placeholder="##__input_capacity__##">
      รท
      <input type="text" name="demands"    placeholder="##__input_demand__##">
      ๏ผ
      <button type="button" onclick="showfreq()">##__button_do_it_now__##</button>
      <input type="text" name="result"     placeholder="">
    </form>


    <H2>##__title_capacity_calculation__##</H2>
    <p>##__text_capacity_calculation__##</p>
    <form name="calccap" action="#">
      <input type="text" name="demands"     placeholder="##__input_demand__##">
      ร
      <input type="text" name="frequencies" placeholder="##__input_frequency__##">
      รท <span id="span_spy">730</span>
      ๏ผ
      <button type="button" onclick="showcap()">##__button_do_it_now__##</button>
      <input type="text" name="result"      placeholder="">
    </form>


    <H2>##__title_rate_calculation__##</H2>
    <p>##__text_rate_calculation__##</p>
    <form name="calcrate" action="#">
      <span id="span_spy">730</span> ร
      <input type="text" name="capacities"  placeholder="##__input_capacity__##">
      รท
      <input type="text" name="frequencies" placeholder="##__input_frequency__##">
      ๏ผ
      <button type="button" onclick="showrate()">##__button_do_it_now__##</button>
      <input type="text" name="result"      placeholder="">
  </body>
</html>
